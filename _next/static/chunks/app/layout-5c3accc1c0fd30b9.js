(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{4758:(e,r,t)=>{Promise.resolve().then(t.bind(t,8103)),Promise.resolve().then(t.bind(t,6722)),Promise.resolve().then(t.t.bind(t,6872,23))},6722:(e,r,t)=>{"use strict";t.d(r,{D:()=>n,ThemeProvider:()=>s});var o=t(5155),a=t(2115);let i=(0,a.createContext)(void 0);function s({children:e}){let[r,t]=(0,a.useState)("light");return(0,a.useEffect)(()=>{let e=localStorage.getItem("theme");e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches&&t("dark")},[]),(0,a.useEffect)(()=>{let e=window.document.documentElement;"dark"===r?e.classList.add("dark"):e.classList.remove("dark"),localStorage.setItem("theme",r)},[r]),(0,o.jsx)(i.Provider,{value:{theme:r,toggleTheme:()=>{t(e=>"light"===e?"dark":"light")}},children:e})}function n(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},6872:()=>{},8103:(e,r,t)=>{"use strict";t.d(r,{AprilTagProvider:()=>s,y:()=>n});var o=t(5155),a=t(2115);let i=(0,a.createContext)(null),s=({children:e})=>{let[r,s]=(0,a.useState)(!1),[n,l]=(0,a.useState)(null),[c,u]=(0,a.useState)([]),d=(0,a.useRef)(null),m=(0,a.useRef)(new Map),w=e=>{console.log("[AprilTagContext]",e),u(r=>[...r.slice(-4),e])};(0,a.useEffect)(()=>{console.log("Creating worker...");let e=new Worker(t.tu(new URL(t.p+t.u(98),t.b)));d.current=e,e.onmessage=e=>{let{type:r,id:t,payload:o,error:a,message:i}=e.data;if("LOG"===r)return void w(`[Worker] ${i}`);if("INIT_SUCCESS"===r){w("Worker Init Success"),s(!0);let e=m.current.get(t);e&&e.resolve()}else if(a){w(`Worker Error: ${a}`),console.error("Worker Error:",a),"ERROR"===r&&t&&t.startsWith("init_")&&l(a);let e=m.current.get(t);e&&e.reject(Error(a))}else{let e=m.current.get(t);e&&(e.resolve(o),m.current.delete(t))}},e.onerror=e=>{w(`Worker script error: ${JSON.stringify(e)}`),console.error("Worker script error:",e),l("Failed to load worker script.")};let o=setTimeout(()=>{r||w("Initialization timed out (15s)")},15e3),a=`${window.location.origin}/camera_calibrator/`,i=`${a}apriltag.js`;console.log(`Initializing worker with publicBaseUrl: ${a}`);let n="init_"+Date.now();return m.current.set(n,{resolve:()=>{},reject:e=>l(e.message)}),e.postMessage({type:"INIT",id:n,payload:{url:i,baseUrl:a}}),()=>{clearTimeout(o),e.terminate()}},[]);let h=(e,r)=>new Promise((t,o)=>{if(!d.current)return void o(Error("Worker not initialized"));let a=e+"_"+Date.now()+"_"+Math.random(),i=setTimeout(()=>{m.current.has(a)&&(m.current.delete(a),o(Error(`Worker timed out for ${e}`)))},6e4);m.current.set(a,{resolve:e=>{clearTimeout(i),t(e)},reject:e=>{clearTimeout(i),o(e)}}),d.current.postMessage({type:e,id:a,payload:r})}),g=async(e,t)=>{try{if(r&&!n)return await h("DETECT",{imageData:e,settings:t});throw console.warn("Worker not ready or failed init, skipping directly to API fallback."),Error("Worker not ready")}catch(a){console.warn("Worker detection failed or not ready, trying API fallback...",a);let r=document.createElement("canvas");r.width=e.width,r.height=e.height;let o=r.getContext("2d");if(!o)throw Error("Could not create canvas context");return o.putImageData(e,0,0),new Promise((e,o)=>{r.toBlob(async r=>{if(!r)return void o(Error("Failed to create blob from image"));let a=new FormData;a.append("image",r,"image.jpg"),a.append("rows",t.rows.toString()),a.append("cols",t.cols.toString());try{let r=await fetch("/camera_calibrator/api/detect",{method:"POST",body:a});if(!r.ok){if(404===r.status){let r=await fetch("/api/detect",{method:"POST",body:a});if(!r.ok)throw Error(await r.text());let t=await r.json();e({found:t.success,corners:t.corners,rows:t.rows,cols:t.cols,error:t.error});return}throw Error(await r.text())}let t=await r.json();e({found:t.success,corners:t.corners,rows:t.rows,cols:t.cols,error:t.error})}catch(e){o(e)}},"image/jpeg")})}},f=async(e,r,t)=>h("CALIBRATE",{allImagePoints:e,objPoints:r,imageSize:t});return(0,o.jsx)(i.Provider,{value:{isReady:r,initError:n,logs:c,detect:g,calibrate:f},children:e})},n=()=>{let e=(0,a.useContext)(i);if(!e)throw Error("useAprilTag must be used within an AprilTagProvider");return e}}},e=>{e.O(0,[513,441,794,358],()=>e(e.s=4758)),_N_E=e.O()}]);