(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{2335:(e,r,t)=>{Promise.resolve().then(t.bind(t,4007)),Promise.resolve().then(t.bind(t,6722)),Promise.resolve().then(t.t.bind(t,6872,23))},4007:(e,r,t)=>{"use strict";t.d(r,{C:()=>s,CalibrationProvider:()=>n});var o=t(5155),i=t(2115);let l=(0,i.createContext)(null),n=({children:e})=>{let[r,n]=(0,i.useState)(!1),[s,a]=(0,i.useState)(null),[u,c]=(0,i.useState)("Initializing..."),[d,m]=(0,i.useState)(!1),h=(0,i.useRef)(null),g=(0,i.useRef)(new Map);(0,i.useEffect)(()=>{},[]),(0,i.useEffect)(()=>{let e=new Worker(t.tu(new URL(t.p+t.u(333),t.b)));h.current=e,e.onmessage=e=>{let{type:t,id:o,payload:i,error:l,message:s}=e.data;if("INIT_SUCCESS"===t){console.log("Worker Init Success"),n(!0),c(null);let e=g.current.get(o);e&&e.resolve()}else if("PROGRESS"===t)r||c(s);else if(l){console.error("Worker Error:",l),"ERROR"===t&&o&&o.startsWith("init_")&&(a(l),c(null));let e=g.current.get(o);e&&e.reject(Error(l))}else{let e=g.current.get(o);e&&(e.resolve(i),g.current.delete(o))}},e.onerror=e=>{console.error("Worker script error:",e),a("Failed to load worker script.")};let o="init_"+Date.now();g.current.set(o,{resolve:()=>{},reject:e=>a(e.message)});let i="/camera_calibrator".replace(/\/$/,""),l=`${window.location.origin}${i}/apriltag.js`;console.log("[Context] Initializing worker with AprilTag URL:",l),e.postMessage({type:"INIT",id:o,payload:{url:l}});let s=setTimeout(()=>{n(e=>e||(console.warn("[Context] Worker init timed out or took too long, forcing UI ready state (features might still be loading)"),c(null),!0))},15e3);return()=>{clearTimeout(s),e.terminate()}},[]);let f=(e,r)=>new Promise((t,o)=>{if(!h.current)return void o(Error("Worker not initialized"));let i=e+"_"+Date.now()+"_"+Math.random(),l=setTimeout(()=>{g.current.has(i)&&(g.current.delete(i),o(Error(`Worker timed out for ${e}`)))},6e4);g.current.set(i,{resolve:e=>{clearTimeout(l),t(e)},reject:e=>{clearTimeout(l),o(e)}}),h.current.postMessage({type:e,id:i,payload:r})}),w=async(e,r)=>("checkerboard"===r.boardType||r.boardType,f("DETECT",{imageData:e,settings:r})),k=async(e,r,t)=>f("CALIBRATE",{allImagePoints:e,objPoints:r,imageSize:t});return(0,o.jsx)(l.Provider,{value:{isReady:r,initError:s,loadingStatus:u,detect:w,calibrate:k},children:e})},s=()=>{let e=(0,i.useContext)(l);if(!e)throw Error("useCalibration must be used within an CalibrationProvider");return e}},6722:(e,r,t)=>{"use strict";t.d(r,{D:()=>s,ThemeProvider:()=>n});var o=t(5155),i=t(2115);let l=(0,i.createContext)(void 0);function n({children:e}){let[r,t]=(0,i.useState)("light");return(0,i.useEffect)(()=>{let e=localStorage.getItem("theme");e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches&&t("dark")},[]),(0,i.useEffect)(()=>{let e=window.document.documentElement;"dark"===r?e.classList.add("dark"):e.classList.remove("dark"),localStorage.setItem("theme",r)},[r]),(0,o.jsx)(l.Provider,{value:{theme:r,toggleTheme:()=>{t(e=>"light"===e?"dark":"light")}},children:e})}function s(){let e=(0,i.useContext)(l);if(void 0===e)throw Error("useTheme must be used within a ThemeProvider");return e}},6872:()=>{}},e=>{e.O(0,[513,441,794,358],()=>e(e.s=2335)),_N_E=e.O()}]);