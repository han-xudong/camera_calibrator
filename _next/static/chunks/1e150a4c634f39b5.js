(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,91709,t=>{"use strict";let e=Object.prototype.toString;function r(t){let r=e.call(t);return r.endsWith("Array]")&&!r.includes("Big")}t.s(["isAnyArray",()=>r])},89363,t=>{"use strict";var e=t.i(91709);function r(t){var r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,e.isAnyArray)(t)){if(0===t.length)throw TypeError("input must not be empty")}else throw TypeError("input must be an array");if(void 0!==s.output){if(!(0,e.isAnyArray)(s.output))throw TypeError("output option must be an array if specified");r=s.output}else r=Array(t.length);var o=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,e.isAnyArray)(t))throw TypeError("input must be an array");if(0===t.length)throw TypeError("input must not be empty");var s=r.fromIndex,o=void 0===s?0:s,i=r.toIndex,n=void 0===i?t.length:i;if(o<0||o>=t.length||!Number.isInteger(o))throw Error("fromIndex must be a positive integer smaller than length");if(n<=o||n>t.length||!Number.isInteger(n))throw Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var l=t[o],h=o+1;h<n;h++)t[h]<l&&(l=t[h]);return l}(t),i=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,e.isAnyArray)(t))throw TypeError("input must be an array");if(0===t.length)throw TypeError("input must not be empty");var s=r.fromIndex,o=void 0===s?0:s,i=r.toIndex,n=void 0===i?t.length:i;if(o<0||o>=t.length||!Number.isInteger(o))throw Error("fromIndex must be a positive integer smaller than length");if(n<=o||n>t.length||!Number.isInteger(n))throw Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var l=t[o],h=o+1;h<n;h++)t[h]>l&&(l=t[h]);return l}(t);if(o===i)throw RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var n=s.min,l=void 0===n?s.autoMinMax?o:0:n,h=s.max,a=void 0===h?s.autoMinMax?i:1:h;if(l>=a)throw RangeError("min option must be smaller than max option");for(var u=(a-l)/(i-o),f=0;f<t.length;f++)r[f]=(t[f]-o)*u+l;return r}t.s(["default",()=>r],89363)},71018,(t,e,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s=t.r(91709),o=t.r(89363);let i=" ".repeat(2),n=" ".repeat(4);function l(t,e={}){let{maxRows:r=15,maxColumns:s=10,maxNumSize:o=8,padMinus:a="auto"}=e;return`${t.constructor.name} {
${i}[
${n}${function(t,e,r,s,o){let{rows:i,columns:l}=t,a=Math.min(i,e),u=Math.min(l,r),f=[];if("auto"===o){o=!1;t:for(let e=0;e<a;e++)for(let r=0;r<u;r++)if(0>t.get(e,r)){o=!0;break t}}for(let e=0;e<a;e++){let r=[];for(let i=0;i<u;i++){var c,m,g;r.push((c=t.get(e,i),m=s,g=o,(c>=0&&g?` ${h(c,m-1)}`:h(c,m)).padEnd(m)))}f.push(`${r.join(" ")}`)}return u!==l&&(f[f.length-1]+=` ... ${l-r} more columns`),a!==i&&f.push(`... ${i-e} more rows`),f.join(`
${n}`)}(t,r,s,o,a)}
${i}]
${i}rows: ${t.rows}
${i}columns: ${t.columns}
}`}function h(t,e){let r=t.toString();if(r.length<=e)return r;let s=t.toFixed(e);if(s.length>e&&(s=t.toFixed(Math.max(0,e-(s.length-e)))),s.length<=e&&!s.startsWith("0.000")&&!s.startsWith("-0.000"))return s;let o=t.toExponential(e);return o.length>e&&(o=t.toExponential(Math.max(0,e-(o.length-e)))),o.slice(0)}function a(t,e,r){let s=r?t.rows:t.rows-1;if(e<0||e>s)throw RangeError("Row index out of range")}function u(t,e,r){let s=r?t.columns:t.columns-1;if(e<0||e>s)throw RangeError("Column index out of range")}function f(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw RangeError("vector size must be the same as the number of columns");return e}function c(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw RangeError("vector size must be the same as the number of rows");return e}function m(t,e){if(!s.isAnyArray(e))throw TypeError("row indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=t.rows)throw RangeError("row indices are out of range")}function g(t,e){if(!s.isAnyArray(e))throw TypeError("column indices must be an array");for(let r=0;r<e.length;r++)if(e[r]<0||e[r]>=t.columns)throw RangeError("column indices are out of range")}function w(t,e,r,s,o){if(5!=arguments.length)throw RangeError("expected 4 arguments");if(d("startRow",e),d("endRow",r),d("startColumn",s),d("endColumn",o),e>r||s>o||e<0||e>=t.rows||r<0||r>=t.rows||s<0||s>=t.columns||o<0||o>=t.columns)throw RangeError("Submatrix indices are out of range")}function p(t,e=0){let r=[];for(let s=0;s<t;s++)r.push(e);return r}function d(t,e){if("number"!=typeof e)throw TypeError(`${t} must be a number`)}function y(t){if(t.isEmpty())throw Error("Empty matrix has no elements to index")}class M{static from1DArray(t,e,r){if(t*e!==r.length)throw RangeError("data length does not match given dimensions");let s=new x(t,e);for(let o=0;o<t;o++)for(let t=0;t<e;t++)s.set(o,t,r[o*e+t]);return s}static rowVector(t){let e=new x(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new x(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new x(t,e)}static ones(t,e){return new x(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw TypeError("options must be an object");let{random:s=Math.random}=r,o=new x(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)o.set(r,t,s());return o}static randInt(t,e,r={}){if("object"!=typeof r)throw TypeError("options must be an object");let{min:s=0,max:o=1e3,random:i=Math.random}=r;if(!Number.isInteger(s))throw TypeError("min must be an integer");if(!Number.isInteger(o))throw TypeError("max must be an integer");if(s>=o)throw RangeError("min must be smaller than max");let n=o-s,l=new x(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=s+Math.round(i()*n);l.set(r,t,e)}return l}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let s=Math.min(t,e),o=this.zeros(t,e);for(let t=0;t<s;t++)o.set(t,t,r);return o}static diag(t,e,r){let s=t.length;void 0===e&&(e=s),void 0===r&&(r=e);let o=Math.min(s,e,r),i=this.zeros(e,r);for(let e=0;e<o;e++)i.set(e,e,t[e]);return i}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,s=t.columns,o=new x(r,s);for(let i=0;i<r;i++)for(let r=0;r<s;r++)o.set(i,r,Math.min(t.get(i,r),e.get(i,r)));return o}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,s=t.columns,o=new this(r,s);for(let i=0;i<r;i++)for(let r=0;r<s;r++)o.set(i,r,Math.max(t.get(i,r),e.get(i,r)));return o}static checkMatrix(t){return M.isMatrix(t)?t:new x(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isEmpty(){return 0===this.rows||0===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let t=0;t<this.rows;t++)if(0!==this.get(t,t))return!1;return!0}isEchelonForm(){let t=0,e=0,r=-1,s=!0,o=!1;for(;t<this.rows&&s;){for(e=0,o=!1;e<this.columns&&!1===o;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(o=!0,r=e):(s=!1,o=!0);t++}return s}isReducedEchelonForm(){let t=0,e=0,r=-1,s=!0,o=!1;for(;t<this.rows&&s;){for(e=0,o=!1;e<this.columns&&!1===o;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(o=!0,r=e):(s=!1,o=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(s=!1);t++}return s}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let s=e;for(let o=e;o<t.rows;o++)t.get(o,r)>t.get(s,r)&&(s=o);if(0===t.get(s,r))r++;else{t.swapRows(e,s);let o=t.get(e,r);for(let s=r;s<t.columns;s++)t.set(e,s,t.get(e,s)/o);for(let s=e+1;s<t.rows;s++){let o=t.get(s,r)/t.get(e,r);t.set(s,r,0);for(let i=r+1;i<t.columns;i++)t.set(s,i,t.get(s,i)-t.get(e,i)*o)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,s=r-1;for(;s>=0;)if(0===t.maxRow(s))s--;else{let o=0,i=!1;for(;o<r&&!1===i;)1===t.get(s,o)?i=!0:o++;for(let r=0;r<s;r++){let i=t.get(r,o);for(let n=o;n<e;n++){let e=t.get(r,n)-i*t.get(s,n);t.set(r,n,e)}}s--}return t}set(){throw Error("set method is unimplemented")}get(){throw Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw TypeError("options must be an object");let{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw TypeError("columns must be a positive integer");let s=new x(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)s.setSubMatrix(this,this.rows*t,this.columns*e);return s}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){a(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return x.rowVector(this.getRow(t))}setRow(t,e){a(this,t),e=f(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){a(this,t),a(this,e);for(let r=0;r<this.columns;r++){let s=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,s)}return this}getColumn(t){u(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return x.columnVector(this.getColumn(t))}setColumn(t,e){u(this,t),e=c(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){u(this,t),u(this,e);for(let r=0;r<this.rows;r++){let s=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,s)}return this}addRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=f(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=c(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){a(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){u(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(t){if(this.isEmpty())return NaN;switch(t){case"row":{let t=Array(this.rows).fill(-1/0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t[e]&&(t[e]=this.get(e,r));return t}case"column":{let t=Array(this.columns).fill(-1/0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t[r]&&(t[r]=this.get(e,r));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}default:throw Error(`invalid option: ${t}`)}}maxIndex(){y(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)>t&&(t=this.get(r,s),e[0]=r,e[1]=s);return e}min(t){if(this.isEmpty())return NaN;switch(t){case"row":{let t=Array(this.rows).fill(1/0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t[e]&&(t[e]=this.get(e,r));return t}case"column":{let t=Array(this.columns).fill(1/0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t[r]&&(t[r]=this.get(e,r));return t}case void 0:{let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}default:throw Error(`invalid option: ${t}`)}}minIndex(){y(this);let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let s=0;s<this.columns;s++)this.get(r,s)<t&&(t=this.get(r,s),e[0]=r,e[1]=s);return e}maxRow(t){if(a(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){a(this,t),y(this);let e=this.get(t,0),r=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)>e&&(e=this.get(t,s),r[1]=s);return r}minRow(t){if(a(this,t),this.isEmpty())return NaN;let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){a(this,t),y(this);let e=this.get(t,0),r=[t,0];for(let s=1;s<this.columns;s++)this.get(t,s)<e&&(e=this.get(t,s),r[1]=s);return r}maxColumn(t){if(u(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){u(this,t),y(this);let e=this.get(0,t),r=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)>e&&(e=this.get(s,t),r[0]=s);return r}minColumn(t){if(u(this,t),this.isEmpty())return NaN;let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){u(this,t),y(this);let e=this.get(0,t),r=[0,t];for(let s=1;s<this.rows;s++)this.get(s,t)<e&&(e=this.get(s,t),r[0]=s);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){switch(t){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw RangeError(`unknown norm type: ${t}`)}}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){M.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw RangeError("vectors do not have the same size");let r=0;for(let s=0;s<e.length;s++)r+=e[s]*t[s];return r}mmul(t){t=x.checkMatrix(t);let e=this.rows,r=this.columns,s=t.columns,o=new x(e,s),i=new Float64Array(r);for(let n=0;n<s;n++){for(let e=0;e<r;e++)i[e]=t.get(e,n);for(let t=0;t<e;t++){let e=0;for(let s=0;s<r;s++)e+=this.get(t,s)*i[s];o.set(t,n,e)}}return o}mpow(t){if(!this.isSquare())throw RangeError("Matrix must be square");if(!Number.isInteger(t)||t<0)throw RangeError("Exponent must be a non-negative integer");let e=x.eye(this.rows),r=this;for(let s=t;s>=1;s/=2)(1&s)!=0&&(e=e.mmul(r)),r=r.mmul(r);return e}strassen2x2(t){t=x.checkMatrix(t);let e=new x(2,2),r=this.get(0,0),s=t.get(0,0),o=this.get(0,1),i=t.get(0,1),n=this.get(1,0),l=t.get(1,0),h=this.get(1,1),a=t.get(1,1),u=(r+h)*(s+a),f=(n+h)*s,c=r*(i-a),m=h*(l-s),g=(r+o)*a;return e.set(0,0,u+m-g+(o-h)*(l+a)),e.set(0,1,c+g),e.set(1,0,f+m),e.set(1,1,u-f+c+(n-r)*(s+i)),e}strassen3x3(t){t=x.checkMatrix(t);let e=new x(3,3),r=this.get(0,0),s=this.get(0,1),o=this.get(0,2),i=this.get(1,0),n=this.get(1,1),l=this.get(1,2),h=this.get(2,0),a=this.get(2,1),u=this.get(2,2),f=t.get(0,0),c=t.get(0,1),m=t.get(0,2),g=t.get(1,0),w=t.get(1,1),p=t.get(1,2),d=t.get(2,0),y=t.get(2,1),M=t.get(2,2),b=(r+s+o-i-n-a-u)*w,E=(r-i)*(-c+w),S=n*(-f+c+g-w-p-d+M),v=(-r+i+n)*(f-c+w),R=(i+n)*(-f+c),A=r*f,C=(-r+h+a)*(f-m+p),k=(-r+h)*(m-p),T=(h+a)*(-f+m),V=(r+s+o-n-l-h-a)*p,I=a*(-f+m+g-w-p-d+y),D=(-o+a+u)*(w+d-y),N=(o-u)*(w-y),q=o*d,z=(a+u)*(-d+y),F=(-o+n+l)*(p+d-M),$=(o-l)*(p-M),P=(n+l)*(-d+M),O=b+v+R+A+D+q+z,j=A+C+T+V+q+F+P,W=E+S+v+A+q+F+$,L=A+C+k+I+D+N+q;return e.set(0,0,A+q+s*g),e.set(0,1,O),e.set(0,2,j),e.set(1,0,W),e.set(1,1,E+v+R+A+l*y),e.set(1,2,q+F+$+P+i*m),e.set(2,0,L),e.set(2,1,D+N+q+z+h*c),e.set(2,2,A+C+k+T+u*M),e}mmulStrassen(t){t=x.checkMatrix(t);let e=this.clone(),r=e.rows,s=e.columns,o=t.rows,i=t.columns;function n(t,e,r){let s=t.rows,o=t.columns;if(s===e&&o===r)return t;{let s=M.zeros(e,r);return s.setSubMatrix(t,0,0)}}s!==o&&console.warn(`Multiplying ${r} x ${s} and ${o} x ${i} matrix: dimensions do not match.`);let l=Math.max(r,o),h=Math.max(s,i);return e=n(e,l,h),function t(e,r,s,o){if(s<=512||o<=512)return e.mmul(r);s%2==1&&o%2==1?(e=n(e,s+1,o+1),r=n(r,s+1,o+1)):s%2==1?(e=n(e,s+1,o),r=n(r,s+1,o)):o%2==1&&(e=n(e,s,o+1),r=n(r,s,o+1));let i=parseInt(e.rows/2,10),l=parseInt(e.columns/2,10),h=e.subMatrix(0,i-1,0,l-1),a=r.subMatrix(0,i-1,0,l-1),u=e.subMatrix(0,i-1,l,e.columns-1),f=r.subMatrix(0,i-1,l,r.columns-1),c=e.subMatrix(i,e.rows-1,0,l-1),m=r.subMatrix(i,r.rows-1,0,l-1),g=e.subMatrix(i,e.rows-1,l,e.columns-1),w=r.subMatrix(i,r.rows-1,l,r.columns-1),p=t(M.add(h,g),M.add(a,w),i,l),d=t(M.add(c,g),a,i,l),y=t(h,M.sub(f,w),i,l),b=t(g,M.sub(m,a),i,l),x=t(M.add(h,u),w,i,l),E=t(M.sub(c,h),M.add(a,f),i,l),S=t(M.sub(u,g),M.add(m,w),i,l),v=M.add(p,b);v.sub(x),v.add(S);let R=M.add(y,x),A=M.add(d,b),C=M.sub(p,d);C.add(y),C.add(E);let k=M.zeros(2*v.rows,2*v.columns);return(k=(k=(k=(k=k.setSubMatrix(v,0,0)).setSubMatrix(R,v.rows,0)).setSubMatrix(A,0,v.columns)).setSubMatrix(C,v.rows,v.columns)).subMatrix(0,s-1,0,o-1)}(e,t=n(t,l,h),l,h)}scaleRows(t={}){if("object"!=typeof t)throw TypeError("options must be an object");let{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw TypeError("min must be a number");if(!Number.isFinite(r))throw TypeError("max must be a number");if(e>=r)throw RangeError("min must be smaller than max");let s=new x(this.rows,this.columns);for(let t=0;t<this.rows;t++){let i=this.getRow(t);i.length>0&&o(i,{min:e,max:r,output:i}),s.setRow(t,i)}return s}scaleColumns(t={}){if("object"!=typeof t)throw TypeError("options must be an object");let{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw TypeError("min must be a number");if(!Number.isFinite(r))throw TypeError("max must be a number");if(e>=r)throw RangeError("min must be smaller than max");let s=new x(this.rows,this.columns);for(let t=0;t<this.columns;t++){let i=this.getColumn(t);i.length&&o(i,{min:e,max:r,output:i}),s.setColumn(t,i)}return s}flipRows(){let t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),s=this.get(e,this.columns-1-r);this.set(e,r,s),this.set(e,this.columns-1-r,t)}return this}flipColumns(){let t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),s=this.get(this.rows-1-r,e);this.set(r,e,s),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=x.checkMatrix(t);let e=this.rows,r=this.columns,s=t.rows,o=t.columns,i=new x(e*s,r*o);for(let n=0;n<e;n++)for(let e=0;e<r;e++)for(let r=0;r<s;r++)for(let l=0;l<o;l++)i.set(s*n+r,o*e+l,this.get(n,e)*t.get(r,l));return i}kroneckerSum(t){if(t=x.checkMatrix(t),!this.isSquare()||!t.isSquare())throw Error("Kronecker Sum needs two Square Matrices");let e=this.rows,r=t.rows,s=this.kroneckerProduct(x.eye(r,r)),o=x.eye(e,e).kroneckerProduct(t);return s.add(o)}transpose(){let t=new x(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=b){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=b){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,s){w(this,t,e,r,s);let o=new x(e-t+1,s-r+1);for(let i=t;i<=e;i++)for(let e=r;e<=s;e++)o.set(i-t,e-r,this.get(i,e));return o}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw RangeError("Argument out of range");let s=new x(t.length,r-e+1);for(let o=0;o<t.length;o++)for(let i=e;i<=r;i++){if(t[o]<0||t[o]>=this.rows)throw RangeError(`Row index out of range: ${t[o]}`);s.set(o,i-e,this.get(t[o],i))}return s}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw RangeError("Argument out of range");let s=new x(r-e+1,t.length);for(let o=0;o<t.length;o++)for(let i=e;i<=r;i++){if(t[o]<0||t[o]>=this.columns)throw RangeError(`Column index out of range: ${t[o]}`);s.set(i-e,o,this.get(i,t[o]))}return s}setSubMatrix(t,e,r){if((t=x.checkMatrix(t)).isEmpty())return this;let s=e+t.rows-1,o=r+t.columns-1;w(this,e,s,r,o);for(let s=0;s<t.rows;s++)for(let o=0;o<t.columns;o++)this.set(e+s,r+o,t.get(s,o));return this}selection(t,e){m(this,t),g(this,e);let r=new x(t.length,e.length);for(let s=0;s<t.length;s++){let o=t[s];for(let t=0;t<e.length;t++){let i=e[t];r.set(s,t,this.get(o,i))}}return r}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){return this.constructor.copy(this,new x(this.rows,this.columns))}static copy(t,e){for(let[r,s,o]of t.entries())e.set(r,s,o);return e}sum(t){switch(t){case"row":return function(t){let e=p(t.rows);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[r]+=t.get(r,s);return e}(this);case"column":return function(t){let e=p(t.columns);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[s]+=t.get(r,s);return e}(this);case void 0:return function(t){let e=0;for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)e+=t.get(r,s);return e}(this);default:throw Error(`invalid option: ${t}`)}}product(t){switch(t){case"row":return function(t){let e=p(t.rows,1);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[r]*=t.get(r,s);return e}(this);case"column":return function(t){let e=p(t.columns,1);for(let r=0;r<t.rows;++r)for(let s=0;s<t.columns;++s)e[s]*=t.get(r,s);return e}(this);case void 0:return function(t){let e=1;for(let r=0;r<t.rows;r++)for(let s=0;s<t.columns;s++)e*=t.get(r,s);return e}(this);default:throw Error(`invalid option: ${t}`)}}mean(t){let e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw Error(`invalid option: ${t}`)}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw TypeError("options must be an object");let{unbiased:r=!0,mean:o=this.mean(t)}=e;if("boolean"!=typeof r)throw TypeError("unbiased must be a boolean");switch(t){case"row":if(!s.isAnyArray(o))throw TypeError("mean must be an array");return function(t,e,r){let s=t.rows,o=t.columns,i=[];for(let n=0;n<s;n++){let s=0,l=0,h=0;for(let e=0;e<o;e++)s+=h=t.get(n,e)-r[n],l+=h*h;e?i.push((l-s*s/o)/(o-1)):i.push((l-s*s/o)/o)}return i}(this,r,o);case"column":if(!s.isAnyArray(o))throw TypeError("mean must be an array");return function(t,e,r){let s=t.rows,o=t.columns,i=[];for(let n=0;n<o;n++){let o=0,l=0,h=0;for(let e=0;e<s;e++)o+=h=t.get(e,n)-r[n],l+=h*h;e?i.push((l-o*o/s)/(s-1)):i.push((l-o*o/s)/s)}return i}(this,r,o);case void 0:if("number"!=typeof o)throw TypeError("mean must be a number");return function(t,e,r){let s=t.rows,o=t.columns,i=s*o,n=0,l=0,h=0;for(let e=0;e<s;e++)for(let s=0;s<o;s++)n+=h=t.get(e,s)-r,l+=h*h;return e?(l-n*n/i)/(i-1):(l-n*n/i)/i}(this,r,o);default:throw Error(`invalid option: ${t}`)}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);let r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw TypeError("options must be an object");let{center:r=this.mean(t)}=e;switch(t){case"row":if(!s.isAnyArray(r))throw TypeError("center must be an array");for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)-r[t]);return this;case"column":if(!s.isAnyArray(r))throw TypeError("center must be an array");for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)-r[e]);return this;case void 0:if("number"!=typeof r)throw TypeError("center must be a number");for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)-r);return this;default:throw Error(`invalid option: ${t}`)}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=function(t){let e=[];for(let r=0;r<t.rows;r++){let s=0;for(let e=0;e<t.columns;e++)s+=t.get(r,e)**2/(t.columns-1);e.push(Math.sqrt(s))}return e}(this);else if(!s.isAnyArray(r))throw TypeError("scale must be an array");var o=r;for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)/o[t]);return this;case"column":if(void 0===r)r=function(t){let e=[];for(let r=0;r<t.columns;r++){let s=0;for(let e=0;e<t.rows;e++)s+=t.get(e,r)**2/(t.rows-1);e.push(Math.sqrt(s))}return e}(this);else if(!s.isAnyArray(r))throw TypeError("scale must be an array");var i=r;for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)/i[e]);return this;case void 0:if(void 0===r)r=function(t){let e=t.size-1,r=0;for(let s=0;s<t.columns;s++)for(let o=0;o<t.rows;o++)r+=t.get(o,s)**2/e;return Math.sqrt(r)}(this);else if("number"!=typeof r)throw TypeError("scale must be a number");var n=r;for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,this.get(t,e)/n);return this;default:throw Error(`invalid option: ${t}`)}}toString(t){return l(this,t)}[Symbol.iterator](){return this.entries()}*entries(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield[t,e,this.get(t,e)]}*values(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)yield this.get(t,e)}}function b(t,e){return t-e}M.prototype.klass="Matrix","undefined"!=typeof Symbol&&(M.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){return l(this)}),M.random=M.rand,M.randomInt=M.randInt,M.diagonal=M.diag,M.prototype.diagonal=M.prototype.diag,M.identity=M.eye,M.prototype.negate=M.prototype.neg,M.prototype.tensorProduct=M.prototype.kroneckerProduct;class x extends M{data;#t(t,e){if(this.data=[],Number.isInteger(e)&&e>=0)for(let r=0;r<t;r++)this.data.push(new Float64Array(e));else throw TypeError("nColumns must be a positive integer");this.rows=t,this.columns=e}constructor(t,e){if(super(),x.isMatrix(t))this.#t(t.rows,t.columns),x.copy(t,this);else if(Number.isInteger(t)&&t>=0)this.#t(t,e);else if(s.isAnyArray(t)){const r=t;if("number"!=typeof(e=(t=r.length)?r[0].length:0))throw TypeError("Data must be a 2D array with at least one element");this.data=[];for(let s=0;s<t;s++){if(r[s].length!==e)throw RangeError("Inconsistent array dimensions");if(!r[s].every(t=>"number"==typeof t))throw TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(r[s]))}this.rows=t,this.columns=e}else throw TypeError("First argument must be a positive number or an array")}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){return a(this,t),this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),a(this,t,!0),e=Float64Array.from(f(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){u(this,t);for(let e=0;e<this.rows;e++){let r=new Float64Array(this.columns-1);for(let s=0;s<t;s++)r[s]=this.data[e][s];for(let s=t+1;s<this.columns;s++)r[s-1]=this.data[e][s];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),u(this,t,!0),e=c(this,e);for(let r=0;r<this.rows;r++){let s=new Float64Array(this.columns+1),o=0;for(;o<t;o++)s[o]=this.data[r][o];for(s[o++]=e[r];o<this.columns+1;o++)s[o]=this.data[r][o-1];this.data[r]=s}return this.columns+=1,this}}M.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},M.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},M.prototype.addM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},M.add=function(t,e){return new x(t).add(e)},M.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},M.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},M.prototype.subM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},M.sub=function(t,e){return new x(t).sub(e)},M.prototype.subtract=M.prototype.sub,M.prototype.subtractS=M.prototype.subS,M.prototype.subtractM=M.prototype.subM,M.subtract=M.sub,M.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},M.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},M.prototype.mulM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},M.mul=function(t,e){return new x(t).mul(e)},M.prototype.multiply=M.prototype.mul,M.prototype.multiplyS=M.prototype.mulS,M.prototype.multiplyM=M.prototype.mulM,M.multiply=M.mul,M.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},M.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},M.prototype.divM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},M.div=function(t,e){return new x(t).div(e)},M.prototype.divide=M.prototype.div,M.prototype.divideS=M.prototype.divS,M.prototype.divideM=M.prototype.divM,M.divide=M.div,M.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},M.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},M.prototype.modM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},M.mod=function(t,e){return new x(t).mod(e)},M.prototype.modulus=M.prototype.mod,M.prototype.modulusS=M.prototype.modS,M.prototype.modulusM=M.prototype.modM,M.modulus=M.mod,M.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},M.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},M.prototype.andM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},M.and=function(t,e){return new x(t).and(e)},M.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},M.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},M.prototype.orM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},M.or=function(t,e){return new x(t).or(e)},M.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},M.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},M.prototype.xorM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},M.xor=function(t,e){return new x(t).xor(e)},M.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},M.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},M.prototype.leftShiftM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},M.leftShift=function(t,e){return new x(t).leftShift(e)},M.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},M.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},M.prototype.signPropagatingRightShiftM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},M.signPropagatingRightShift=function(t,e){return new x(t).signPropagatingRightShift(e)},M.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},M.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},M.prototype.rightShiftM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},M.rightShift=function(t,e){return new x(t).rightShift(e)},M.prototype.zeroFillRightShift=M.prototype.rightShift,M.prototype.zeroFillRightShiftS=M.prototype.rightShiftS,M.prototype.zeroFillRightShiftM=M.prototype.rightShiftM,M.zeroFillRightShift=M.rightShift,M.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},M.not=function(t){return new x(t).not()},M.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},M.abs=function(t){return new x(t).abs()},M.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},M.acos=function(t){return new x(t).acos()},M.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},M.acosh=function(t){return new x(t).acosh()},M.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},M.asin=function(t){return new x(t).asin()},M.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},M.asinh=function(t){return new x(t).asinh()},M.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},M.atan=function(t){return new x(t).atan()},M.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},M.atanh=function(t){return new x(t).atanh()},M.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},M.cbrt=function(t){return new x(t).cbrt()},M.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},M.ceil=function(t){return new x(t).ceil()},M.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},M.clz32=function(t){return new x(t).clz32()},M.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},M.cos=function(t){return new x(t).cos()},M.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},M.cosh=function(t){return new x(t).cosh()},M.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},M.exp=function(t){return new x(t).exp()},M.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},M.expm1=function(t){return new x(t).expm1()},M.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},M.floor=function(t){return new x(t).floor()},M.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},M.fround=function(t){return new x(t).fround()},M.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},M.log=function(t){return new x(t).log()},M.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},M.log1p=function(t){return new x(t).log1p()},M.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},M.log10=function(t){return new x(t).log10()},M.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},M.log2=function(t){return new x(t).log2()},M.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},M.round=function(t){return new x(t).round()},M.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},M.sign=function(t){return new x(t).sign()},M.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},M.sin=function(t){return new x(t).sin()},M.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},M.sinh=function(t){return new x(t).sinh()},M.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},M.sqrt=function(t){return new x(t).sqrt()},M.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},M.tan=function(t){return new x(t).tan()},M.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},M.tanh=function(t){return new x(t).tanh()},M.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},M.trunc=function(t){return new x(t).trunc()},M.pow=function(t,e){return new x(t).pow(e)},M.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},M.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)**t);return this},M.prototype.powM=function(t){if(t=x.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)**t.get(e,r));return this};class E extends M{#e;get size(){return this.#e.size}get rows(){return this.#e.rows}get columns(){return this.#e.columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(t){return x.isMatrix(t)&&"SymmetricMatrix"===t.klassType}static zeros(t){return new this(t)}static ones(t){return new this(t).fill(1)}constructor(t){if(super(),x.isMatrix(t)){if(!t.isSymmetric())throw TypeError("not symmetric data");this.#e=x.copy(t,new x(t.rows,t.rows))}else if(Number.isInteger(t)&&t>=0)this.#e=new x(t,t);else if(this.#e=new x(t),!this.isSymmetric())throw TypeError("not symmetric data")}clone(){let t=new E(this.diagonalSize);for(let[e,r,s]of this.upperRightEntries())t.set(e,r,s);return t}toMatrix(){return new x(this)}get(t,e){return this.#e.get(t,e)}set(t,e,r){return this.#e.set(t,e,r),this.#e.set(e,t,r),this}removeCross(t){return this.#e.removeRow(t),this.#e.removeColumn(t),this}addCross(t,e){void 0===e&&(e=t,t=this.diagonalSize);let r=e.slice();return r.splice(t,1),this.#e.addRow(t,r),this.#e.addColumn(t,e),this}applyMask(t){if(t.length!==this.diagonalSize)throw RangeError("Mask size do not match with matrix size");let e=[];for(let[r,s]of t.entries())s||e.push(r);for(let t of(e.reverse(),e))this.removeCross(t);return this}toCompact(){let{diagonalSize:t}=this,e=Array(t*(t+1)/2);for(let r=0,s=0,o=0;o<e.length;o++)e[o]=this.get(s,r),++r>=t&&(r=++s);return e}static fromCompact(t){let e=t.length,r=(Math.sqrt(8*e+1)-1)/2;if(!Number.isInteger(r))throw TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(t)}`);let s=new E(r);for(let o=0,i=0,n=0;n<e;n++)s.set(o,i,t[n]),++o>=r&&(o=++i);return s}*upperRightEntries(){for(let t=0,e=0;t<this.diagonalSize;){let r=this.get(t,e);yield[t,e,r],++e>=this.diagonalSize&&(e=++t)}}*upperRightValues(){for(let t=0,e=0;t<this.diagonalSize;){let r=this.get(t,e);yield r,++e>=this.diagonalSize&&(e=++t)}}}E.prototype.klassType="SymmetricMatrix";class S extends E{static isDistanceMatrix(t){return E.isSymmetricMatrix(t)&&"DistanceMatrix"===t.klassSubType}constructor(t){if(super(t),!this.isDistance())throw TypeError("Provided arguments do no produce a distance matrix")}set(t,e,r){return t===e&&(r=0),super.set(t,e,r)}addCross(t,e){return void 0===e&&(e=t,t=this.diagonalSize),(e=e.slice())[t]=0,super.addCross(t,e)}toSymmetricMatrix(){return new E(this)}clone(){let t=new S(this.diagonalSize);for(let[e,r,s]of this.upperRightEntries())e!==r&&t.set(e,r,s);return t}toCompact(){let{diagonalSize:t}=this,e=Array((t-1)*t/2);for(let r=1,s=0,o=0;o<e.length;o++)e[o]=this.get(s,r),++r>=t&&(r=++s+1);return e}static fromCompact(t){let e=t.length;if(0===e)return new this(0);let r=(Math.sqrt(8*e+1)+1)/2;if(!Number.isInteger(r))throw TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(t)}`);let s=new this(r);for(let o=1,i=0,n=0;n<e;n++)s.set(o,i,t[n]),++o>=r&&(o=++i+1);return s}}S.prototype.klassSubType="DistanceMatrix";class v extends M{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class R extends v{constructor(t,e,r){m(t,e),g(t,r),super(t,e.length,r.length),this.rowIndices=e,this.columnIndices=r}set(t,e,r){return this.matrix.set(this.rowIndices[t],this.columnIndices[e],r),this}get(t,e){return this.matrix.get(this.rowIndices[t],this.columnIndices[e])}}class A extends M{constructor(t,e={}){const{rows:r=1}=e;if(t.length%r!=0)throw Error("the data length is not divisible by the number of rows");super(),this.rows=r,this.columns=t.length/r,this.data=t}set(t,e,r){let s=this._calculateIndex(t,e);return this.data[s]=r,this}get(t,e){let r=this._calculateIndex(t,e);return this.data[r]}_calculateIndex(t,e){return t*this.columns+e}}class C extends M{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}class k{constructor(t){let e,r,s,o,i,n,l,h,a,u=(t=C.checkMatrix(t)).clone(),f=u.rows,c=u.columns,m=new Float64Array(f),g=1;for(e=0;e<f;e++)m[e]=e;for(r=0,h=new Float64Array(f);r<c;r++){for(e=0;e<f;e++)h[e]=u.get(e,r);for(e=0;e<f;e++){for(s=0,a=Math.min(e,r),i=0;s<a;s++)i+=u.get(e,s)*h[s];h[e]-=i,u.set(e,r,h[e])}for(o=r,e=r+1;e<f;e++)Math.abs(h[e])>Math.abs(h[o])&&(o=e);if(o!==r){for(s=0;s<c;s++)n=u.get(o,s),u.set(o,s,u.get(r,s)),u.set(r,s,n);l=m[o],m[o]=m[r],m[r]=l,g=-g}if(r<f&&0!==u.get(r,r))for(e=r+1;e<f;e++)u.set(e,r,u.get(e,r)/u.get(r,r))}this.LU=u,this.pivotVector=m,this.pivotSign=g}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){let e,r,s;t=x.checkMatrix(t);let o=this.LU;if(o.rows!==t.rows)throw Error("Invalid matrix dimensions");if(this.isSingular())throw Error("LU matrix is singular");let i=t.columns,n=t.subMatrixRow(this.pivotVector,0,i-1),l=o.columns;for(s=0;s<l;s++)for(e=s+1;e<l;e++)for(r=0;r<i;r++)n.set(e,r,n.get(e,r)-n.get(s,r)*o.get(e,s));for(s=l-1;s>=0;s--){for(r=0;r<i;r++)n.set(s,r,n.get(s,r)/o.get(s,s));for(e=0;e<s;e++)for(r=0;r<i;r++)n.set(e,r,n.get(e,r)-n.get(s,r)*o.get(e,s))}return n}get determinant(){let t=this.LU;if(!t.isSquare())throw Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let s=0;s<r;s++)e*=t.get(s,s);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,s=new x(e,r);for(let o=0;o<e;o++)for(let e=0;e<r;e++)o>e?s.set(o,e,t.get(o,e)):o===e?s.set(o,e,1):s.set(o,e,0);return s}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,s=new x(e,r);for(let o=0;o<e;o++)for(let e=0;e<r;e++)o<=e?s.set(o,e,t.get(o,e)):s.set(o,e,0);return s}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function T(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class V{constructor(t){let e,r,s,o,i=(t=C.checkMatrix(t)).clone(),n=t.rows,l=t.columns,h=new Float64Array(l);for(s=0;s<l;s++){let t=0;for(e=s;e<n;e++)t=T(t,i.get(e,s));if(0!==t){for(0>i.get(s,s)&&(t=-t),e=s;e<n;e++)i.set(e,s,i.get(e,s)/t);for(i.set(s,s,i.get(s,s)+1),r=s+1;r<l;r++){for(o=0,e=s;e<n;e++)o+=i.get(e,s)*i.get(e,r);for(o=-o/i.get(s,s),e=s;e<n;e++)i.set(e,r,i.get(e,r)+o*i.get(e,s))}}h[s]=-t}this.QR=i,this.Rdiag=h}solve(t){let e,r,s,o;t=x.checkMatrix(t);let i=this.QR,n=i.rows;if(t.rows!==n)throw Error("Matrix row dimensions must agree");if(!this.isFullRank())throw Error("Matrix is rank deficient");let l=t.columns,h=t.clone(),a=i.columns;for(s=0;s<a;s++)for(r=0;r<l;r++){for(o=0,e=s;e<n;e++)o+=i.get(e,s)*h.get(e,r);for(o=-o/i.get(s,s),e=s;e<n;e++)h.set(e,r,h.get(e,r)+o*i.get(e,s))}for(s=a-1;s>=0;s--){for(r=0;r<l;r++)h.set(s,r,h.get(s,r)/this.Rdiag[s]);for(e=0;e<s;e++)for(r=0;r<l;r++)h.set(e,r,h.get(e,r)-h.get(s,r)*i.get(e,s))}return h.subMatrix(0,a-1,0,l-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,s=r.columns,o=new x(s,s);for(t=0;t<s;t++)for(e=0;e<s;e++)t<e?o.set(t,e,r.get(t,e)):t===e?o.set(t,e,this.Rdiag[t]):o.set(t,e,0);return o}get orthogonalMatrix(){let t,e,r,s,o=this.QR,i=o.rows,n=o.columns,l=new x(i,n);for(r=n-1;r>=0;r--){for(t=0;t<i;t++)l.set(t,r,0);for(l.set(r,r,1),e=r;e<n;e++)if(0!==o.get(r,r)){for(s=0,t=r;t<i;t++)s+=o.get(t,r)*l.get(t,e);for(s=-s/o.get(r,r),t=r;t<i;t++)l.set(t,e,l.get(t,e)+s*o.get(t,r))}}return l}}class I{constructor(t,e={}){let r;if((t=C.checkMatrix(t)).isEmpty())throw Error("Matrix must be non-empty");let s=t.rows,o=t.columns;const{computeLeftSingularVectors:i=!0,computeRightSingularVectors:n=!0,autoTranspose:l=!1}=e;let h=!!i,a=!!n,u=!1;if(s<o)if(l){s=(r=t.transpose()).rows,o=r.columns,u=!0;let e=h;h=a,a=e}else r=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else r=t.clone();let f=Math.min(s,o),c=Math.min(s+1,o),m=new Float64Array(c),g=new x(s,f),w=new x(o,o),p=new Float64Array(o),d=new Float64Array(s),y=new Float64Array(c);for(let t=0;t<c;t++)y[t]=t;let M=Math.min(s-1,o),b=Math.max(0,Math.min(o-2,s)),E=Math.max(M,b);for(let t=0;t<E;t++){if(t<M){m[t]=0;for(let e=t;e<s;e++)m[t]=T(m[t],r.get(e,t));if(0!==m[t]){0>r.get(t,t)&&(m[t]=-m[t]);for(let e=t;e<s;e++)r.set(e,t,r.get(e,t)/m[t]);r.set(t,t,r.get(t,t)+1)}m[t]=-m[t]}for(let e=t+1;e<o;e++){if(t<M&&0!==m[t]){let o=0;for(let i=t;i<s;i++)o+=r.get(i,t)*r.get(i,e);o=-o/r.get(t,t);for(let i=t;i<s;i++)r.set(i,e,r.get(i,e)+o*r.get(i,t))}p[e]=r.get(t,e)}if(h&&t<M)for(let e=t;e<s;e++)g.set(e,t,r.get(e,t));if(t<b){p[t]=0;for(let e=t+1;e<o;e++)p[t]=T(p[t],p[e]);if(0!==p[t]){p[t+1]<0&&(p[t]=0-p[t]);for(let e=t+1;e<o;e++)p[e]/=p[t];p[t+1]+=1}if(p[t]=-p[t],t+1<s&&0!==p[t]){for(let e=t+1;e<s;e++)d[e]=0;for(let e=t+1;e<s;e++)for(let s=t+1;s<o;s++)d[e]+=p[s]*r.get(e,s);for(let e=t+1;e<o;e++){let o=-p[e]/p[t+1];for(let i=t+1;i<s;i++)r.set(i,e,r.get(i,e)+o*d[i])}}if(a)for(let e=t+1;e<o;e++)w.set(e,t,p[e])}}let S=Math.min(o,s+1);if(M<o&&(m[M]=r.get(M,M)),s<S&&(m[S-1]=0),b+1<S&&(p[b]=r.get(b,S-1)),p[S-1]=0,h){for(let t=M;t<f;t++){for(let e=0;e<s;e++)g.set(e,t,0);g.set(t,t,1)}for(let t=M-1;t>=0;t--)if(0!==m[t]){for(let e=t+1;e<f;e++){let r=0;for(let o=t;o<s;o++)r+=g.get(o,t)*g.get(o,e);r=-r/g.get(t,t);for(let o=t;o<s;o++)g.set(o,e,g.get(o,e)+r*g.get(o,t))}for(let e=t;e<s;e++)g.set(e,t,-g.get(e,t));g.set(t,t,1+g.get(t,t));for(let e=0;e<t-1;e++)g.set(e,t,0)}else{for(let e=0;e<s;e++)g.set(e,t,0);g.set(t,t,1)}}if(a)for(let t=o-1;t>=0;t--){if(t<b&&0!==p[t])for(let e=t+1;e<o;e++){let r=0;for(let s=t+1;s<o;s++)r+=w.get(s,t)*w.get(s,e);r=-r/w.get(t+1,t);for(let s=t+1;s<o;s++)w.set(s,e,w.get(s,e)+r*w.get(s,t))}for(let e=0;e<o;e++)w.set(e,t,0);w.set(t,t,1)}let v=S-1,R=Number.EPSILON;for(;S>0;){let t,e;for(t=S-2;t>=-1&&-1!==t;t--){const e=5e-324+R*Math.abs(m[t]+Math.abs(m[t+1]));if(Math.abs(p[t])<=e||Number.isNaN(p[t])){p[t]=0;break}}if(t===S-2)e=4;else{let r;for(r=S-1;r>=t&&r!==t;r--){let e=(r!==S?Math.abs(p[r]):0)+(r!==t+1?Math.abs(p[r-1]):0);if(Math.abs(m[r])<=R*e){m[r]=0;break}}r===t?e=3:r===S-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=p[S-2];p[S-2]=0;for(let r=S-2;r>=t;r--){let s=T(m[r],e),i=m[r]/s,n=e/s;if(m[r]=s,r!==t&&(e=-n*p[r-1],p[r-1]=i*p[r-1]),a)for(let t=0;t<o;t++)s=i*w.get(t,r)+n*w.get(t,S-1),w.set(t,S-1,-n*w.get(t,r)+i*w.get(t,S-1)),w.set(t,r,s)}break}case 2:{let e=p[t-1];p[t-1]=0;for(let r=t;r<S;r++){let o=T(m[r],e),i=m[r]/o,n=e/o;if(m[r]=o,e=-n*p[r],p[r]=i*p[r],h)for(let e=0;e<s;e++)o=i*g.get(e,r)+n*g.get(e,t-1),g.set(e,t-1,-n*g.get(e,r)+i*g.get(e,t-1)),g.set(e,r,o)}break}case 3:{const e=Math.max(Math.abs(m[S-1]),Math.abs(m[S-2]),Math.abs(p[S-2]),Math.abs(m[t]),Math.abs(p[t])),r=m[S-1]/e,i=m[S-2]/e,n=p[S-2]/e,l=m[t]/e,u=p[t]/e,f=((i+r)*(i-r)+n*n)/2,c=r*n*(r*n);let d=0;(0!==f||0!==c)&&(d=f<0?0-Math.sqrt(f*f+c):Math.sqrt(f*f+c),d=c/(f+d));let y=(l+r)*(l-r)+d,M=l*u;for(let e=t;e<S-1;e++){let r=T(y,M);0===r&&(r=5e-324);let i=y/r,n=M/r;if(e!==t&&(p[e-1]=r),y=i*m[e]+n*p[e],p[e]=i*p[e]-n*m[e],M=n*m[e+1],m[e+1]=i*m[e+1],a)for(let t=0;t<o;t++)r=i*w.get(t,e)+n*w.get(t,e+1),w.set(t,e+1,-n*w.get(t,e)+i*w.get(t,e+1)),w.set(t,e,r);if(0===(r=T(y,M))&&(r=5e-324),i=y/r,n=M/r,m[e]=r,y=i*p[e]+n*m[e+1],m[e+1]=-n*p[e]+i*m[e+1],M=n*p[e+1],p[e+1]=i*p[e+1],h&&e<s-1)for(let t=0;t<s;t++)r=i*g.get(t,e)+n*g.get(t,e+1),g.set(t,e+1,-n*g.get(t,e)+i*g.get(t,e+1)),g.set(t,e,r)}p[S-2]=y;break}case 4:if(m[t]<=0&&(m[t]=m[t]<0?-m[t]:0,a))for(let e=0;e<=v;e++)w.set(e,t,-w.get(e,t));for(;t<v&&!(m[t]>=m[t+1]);){let e=m[t];if(m[t]=m[t+1],m[t+1]=e,a&&t<o-1)for(let r=0;r<o;r++)e=w.get(r,t+1),w.set(r,t+1,w.get(r,t)),w.set(r,t,e);if(h&&t<s-1)for(let r=0;r<s;r++)e=g.get(r,t+1),g.set(r,t+1,g.get(r,t)),g.set(r,t,e);t++}S--}}if(u){let t=w;w=g,g=t}this.m=s,this.n=o,this.s=m,this.U=g,this.V=w}solve(t){let e=this.threshold,r=this.s.length,s=x.zeros(r,r);for(let t=0;t<r;t++)Math.abs(this.s[t])<=e?s.set(t,t,0):s.set(t,t,1/this.s[t]);let o=this.U,i=this.rightSingularVectors,n=i.mmul(s),l=i.rows,h=o.rows,a=x.zeros(l,h);for(let t=0;t<l;t++)for(let e=0;e<h;e++){let s=0;for(let i=0;i<r;i++)s+=n.get(t,i)*o.get(e,i);a.set(t,e,s)}return a.mmul(t)}solveForDiagonal(t){return this.solve(x.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,s=t.columns,o=new x(r,this.s.length);for(let i=0;i<r;i++)for(let r=0;r<s;r++)Math.abs(this.s[r])>e&&o.set(i,r,t.get(i,r)/this.s[r]);let i=this.U,n=i.rows,l=i.columns,h=new x(r,n);for(let t=0;t<r;t++)for(let e=0;e<n;e++){let r=0;for(let s=0;s<l;s++)r+=o.get(t,s)*i.get(e,s);h.set(t,e,r)}return h}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let s=0,o=r.length;s<o;s++)r[s]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return x.diag(this.s)}}function D(t,e,r=!1){return(t=C.checkMatrix(t),e=C.checkMatrix(e),r)?new I(t).solve(e):t.isSquare()?new k(t).solve(e):new V(t).solve(e)}class N{constructor(t,e={}){let r,s;const{assumeSymmetric:o=!1}=e;if(!(t=C.checkMatrix(t)).isSquare())throw Error("Matrix is not a square matrix");if(t.isEmpty())throw Error("Matrix must be non-empty");let i=t.columns,n=new x(i,i),l=new Float64Array(i),h=new Float64Array(i),a=t;if(o||t.isSymmetric()){for(r=0;r<i;r++)for(s=0;s<i;s++)n.set(r,s,a.get(r,s));(function(t,e,r,s){let o,i,n,l,h,a,u,f;for(h=0;h<t;h++)r[h]=s.get(t-1,h);for(l=t-1;l>0;l--){for(a=0,f=0,n=0;a<l;a++)f+=Math.abs(r[a]);if(0===f)for(h=0,e[l]=r[l-1];h<l;h++)r[h]=s.get(l-1,h),s.set(l,h,0),s.set(h,l,0);else{for(a=0;a<l;a++)r[a]/=f,n+=r[a]*r[a];for(o=r[l-1],i=Math.sqrt(n),o>0&&(i=-i),e[l]=f*i,n-=o*i,r[l-1]=o-i,h=0;h<l;h++)e[h]=0;for(h=0;h<l;h++){for(o=r[h],s.set(h,l,o),i=e[h]+s.get(h,h)*o,a=h+1;a<=l-1;a++)i+=s.get(a,h)*r[a],e[a]+=s.get(a,h)*o;e[h]=i}for(h=0,o=0;h<l;h++)e[h]/=n,o+=e[h]*r[h];for(h=0,u=o/(n+n);h<l;h++)e[h]-=u*r[h];for(h=0;h<l;h++){for(o=r[h],i=e[h],a=h;a<=l-1;a++)s.set(a,h,s.get(a,h)-(o*e[a]+i*r[a]));r[h]=s.get(l-1,h),s.set(l,h,0)}}r[l]=n}for(l=0;l<t-1;l++){if(s.set(t-1,l,s.get(l,l)),s.set(l,l,1),0!==(n=r[l+1])){for(a=0;a<=l;a++)r[a]=s.get(a,l+1)/n;for(h=0;h<=l;h++){for(a=0,i=0;a<=l;a++)i+=s.get(a,l+1)*s.get(a,h);for(a=0;a<=l;a++)s.set(a,h,s.get(a,h)-i*r[a])}}for(a=0;a<=l;a++)s.set(a,l+1,0)}for(h=0;h<t;h++)r[h]=s.get(t-1,h),s.set(t-1,h,0);s.set(t-1,t-1,1),e[0]=0})(i,h,l,n),function(t,e,r,s){let o,i,n,l,h,a,u,f,c,m,g,w,p,d,y,M;for(n=1;n<t;n++)e[n-1]=e[n];e[t-1]=0;let b=0,x=0,E=Number.EPSILON;for(a=0;a<t;a++){for(x=Math.max(x,Math.abs(r[a])+Math.abs(e[a])),u=a;u<t&&!(Math.abs(e[u])<=E*x);)u++;if(u>a)do{for(o=r[a],c=T(f=(r[a+1]-o)/(2*e[a]),1),f<0&&(c=-c),r[a]=e[a]/(f+c),r[a+1]=e[a]*(f+c),m=r[a+1],i=o-r[a],n=a+2;n<t;n++)r[n]-=i;for(b+=i,f=r[u],w=g=1,p=g,d=e[a+1],y=0,M=0,n=u-1;n>=a;n--)for(h=0,p=w,w=g,M=y,o=g*e[n],i=g*f,c=T(f,e[n]),e[n+1]=y*c,y=e[n]/c,f=(g=f/c)*r[n]-y*o,r[n+1]=i+y*(g*o+y*r[n]);h<t;h++)i=s.get(h,n+1),s.set(h,n+1,y*s.get(h,n)+g*i),s.set(h,n,g*s.get(h,n)-y*i);f=-y*M*p*d*e[a]/m,e[a]=y*f,r[a]=g*f}while(Math.abs(e[a])>E*x)r[a]=r[a]+b,e[a]=0}for(n=0;n<t-1;n++){for(h=n,f=r[n],l=n+1;l<t;l++)r[l]<f&&(h=l,f=r[l]);if(h!==n)for(l=0,r[h]=r[n],r[n]=f;l<t;l++)f=s.get(l,n),s.set(l,n,s.get(l,h)),s.set(l,h,f)}}(i,h,l,n)}else{let t=new x(i,i),e=new Float64Array(i);for(s=0;s<i;s++)for(r=0;r<i;r++)t.set(r,s,a.get(r,s));(function(t,e,r,s){let o,i,n,l,h,a,u,f=t-1;for(a=1;a<=f-1;a++){for(u=0,l=a;l<=f;l++)u+=Math.abs(e.get(l,a-1));if(0!==u){for(n=0,l=f;l>=a;l--)r[l]=e.get(l,a-1)/u,n+=r[l]*r[l];for(i=Math.sqrt(n),r[a]>0&&(i=-i),n-=r[a]*i,r[a]=r[a]-i,h=a;h<t;h++){for(o=0,l=f;l>=a;l--)o+=r[l]*e.get(l,h);for(o/=n,l=a;l<=f;l++)e.set(l,h,e.get(l,h)-o*r[l])}for(l=0;l<=f;l++){for(o=0,h=f;h>=a;h--)o+=r[h]*e.get(l,h);for(o/=n,h=a;h<=f;h++)e.set(l,h,e.get(l,h)-o*r[h])}r[a]=u*r[a],e.set(a,a-1,u*i)}}for(l=0;l<t;l++)for(h=0;h<t;h++)s.set(l,h,+(l===h));for(a=f-1;a>=1;a--)if(0!==e.get(a,a-1)){for(l=a+1;l<=f;l++)r[l]=e.get(l,a-1);for(h=a;h<=f;h++){for(i=0,l=a;l<=f;l++)i+=r[l]*s.get(l,h);for(i=i/r[a]/e.get(a,a-1),l=a;l<=f;l++)s.set(l,h,s.get(l,h)+i*r[l])}}})(i,t,e,n),function(t,e,r,s,o){let i,n,l,h,a,u,f,c,m,g,w,p,d,y,M,b=t-1,x=t-1,E=Number.EPSILON,S=0,v=0,R=0,A=0,C=0,k=0,T=0,V=0;for(i=0;i<t;i++)for((i<0||i>x)&&(r[i]=o.get(i,i),e[i]=0),n=Math.max(i-1,0);n<t;n++)v+=Math.abs(o.get(i,n));for(;b>=0;){for(h=b;h>0&&(0===(k=Math.abs(o.get(h-1,h-1))+Math.abs(o.get(h,h)))&&(k=v),!(Math.abs(o.get(h,h-1))<E*k));)h--;if(h===b)o.set(b,b,o.get(b,b)+S),r[b]=o.get(b,b),e[b]=0,b--,V=0;else if(h===b-1){if(f=o.get(b,b-1)*o.get(b-1,b),T=Math.sqrt(Math.abs(A=(R=(o.get(b-1,b-1)-o.get(b,b))/2)*R+f)),o.set(b,b,o.get(b,b)+S),o.set(b-1,b-1,o.get(b-1,b-1)+S),c=o.get(b,b),A>=0){for(T=R>=0?R+T:R-T,r[b-1]=c+T,r[b]=r[b-1],0!==T&&(r[b]=c-f/T),e[b-1]=0,e[b]=0,k=Math.abs(c=o.get(b,b-1))+Math.abs(T),C=Math.sqrt((R=c/k)*R+(A=T/k)*A),R/=C,A/=C,n=b-1;n<t;n++)T=o.get(b-1,n),o.set(b-1,n,A*T+R*o.get(b,n)),o.set(b,n,A*o.get(b,n)-R*T);for(i=0;i<=b;i++)T=o.get(i,b-1),o.set(i,b-1,A*T+R*o.get(i,b)),o.set(i,b,A*o.get(i,b)-R*T);for(i=0;i<=x;i++)T=s.get(i,b-1),s.set(i,b-1,A*T+R*s.get(i,b)),s.set(i,b,A*s.get(i,b)-R*T)}else r[b-1]=c+R,r[b]=c+R,e[b-1]=T,e[b]=-T;b-=2,V=0}else{if(c=o.get(b,b),m=0,f=0,h<b&&(m=o.get(b-1,b-1),f=o.get(b,b-1)*o.get(b-1,b)),10===V){for(S+=c,i=0;i<=b;i++)o.set(i,i,o.get(i,i)-c);c=m=.75*(k=Math.abs(o.get(b,b-1))+Math.abs(o.get(b-1,b-2))),f=-.4375*k*k}if(30===V&&(k=(k=(m-c)/2)*k+f)>0){for(k=Math.sqrt(k),m<c&&(k=-k),k=c-f/((m-c)/2+k),i=0;i<=b;i++)o.set(i,i,o.get(i,i)-k);S+=k,c=m=f=.964}for(V+=1,a=b-2;a>=h&&(R=((C=c-(T=o.get(a,a)))*(k=m-T)-f)/o.get(a+1,a)+o.get(a,a+1),k=Math.abs(R)+Math.abs(A=o.get(a+1,a+1)-T-C-k)+Math.abs(C=o.get(a+2,a+1)),R/=k,A/=k,C/=k,!(a===h||Math.abs(o.get(a,a-1))*(Math.abs(A)+Math.abs(C))<E*(Math.abs(R)*(Math.abs(o.get(a-1,a-1))+Math.abs(T)+Math.abs(o.get(a+1,a+1))))));)a--;for(i=a+2;i<=b;i++)o.set(i,i-2,0),i>a+2&&o.set(i,i-3,0);for(l=a;l<=b-1&&(y=l!==b-1,l!==a&&(R=o.get(l,l-1),0!==(c=Math.abs(R)+Math.abs(A=o.get(l+1,l-1))+Math.abs(C=y?o.get(l+2,l-1):0))&&(R/=c,A/=c,C/=c)),0!==c);l++)if(k=Math.sqrt(R*R+A*A+C*C),R<0&&(k=-k),0!==k){for(l!==a?o.set(l,l-1,-k*c):h!==a&&o.set(l,l-1,-o.get(l,l-1)),R+=k,c=R/k,m=A/k,T=C/k,A/=R,C/=R,n=l;n<t;n++)R=o.get(l,n)+A*o.get(l+1,n),y&&(R+=C*o.get(l+2,n),o.set(l+2,n,o.get(l+2,n)-R*T)),o.set(l,n,o.get(l,n)-R*c),o.set(l+1,n,o.get(l+1,n)-R*m);for(i=0;i<=Math.min(b,l+3);i++)R=c*o.get(i,l)+m*o.get(i,l+1),y&&(R+=T*o.get(i,l+2),o.set(i,l+2,o.get(i,l+2)-R*C)),o.set(i,l,o.get(i,l)-R),o.set(i,l+1,o.get(i,l+1)-R*A);for(i=0;i<=x;i++)R=c*s.get(i,l)+m*s.get(i,l+1),y&&(R+=T*s.get(i,l+2),s.set(i,l+2,s.get(i,l+2)-R*C)),s.set(i,l,s.get(i,l)-R),s.set(i,l+1,s.get(i,l+1)-R*A)}}}if(0!==v){for(b=t-1;b>=0;b--)if(R=r[b],0===(A=e[b]))for(h=b,o.set(b,b,1),i=b-1;i>=0;i--){for(f=o.get(i,i)-R,C=0,n=h;n<=b;n++)C+=o.get(i,n)*o.get(n,b);if(e[i]<0)T=f,k=C;else if(h=i,0===e[i]?o.set(i,b,0!==f?-C/f:-C/(E*v)):(c=o.get(i,i+1),m=o.get(i+1,i),u=(c*k-T*C)/(A=(r[i]-R)*(r[i]-R)+e[i]*e[i]),o.set(i,b,u),o.set(i+1,b,Math.abs(c)>Math.abs(T)?(-C-f*u)/c:(-k-m*u)/T)),E*(u=Math.abs(o.get(i,b)))*u>1)for(n=i;n<=b;n++)o.set(n,b,o.get(n,b)/u)}else if(A<0)for(h=b-1,Math.abs(o.get(b,b-1))>Math.abs(o.get(b-1,b))?(o.set(b-1,b-1,A/o.get(b,b-1)),o.set(b-1,b,-(o.get(b,b)-R)/o.get(b,b-1))):(M=q(0,-o.get(b-1,b),o.get(b-1,b-1)-R,A),o.set(b-1,b-1,M[0]),o.set(b-1,b,M[1])),o.set(b,b-1,0),o.set(b,b,1),i=b-2;i>=0;i--){for(g=0,w=0,n=h;n<=b;n++)g+=o.get(i,n)*o.get(n,b-1),w+=o.get(i,n)*o.get(n,b);if(f=o.get(i,i)-R,e[i]<0)T=f,C=g,k=w;else if(h=i,0===e[i]?(M=q(-g,-w,f,A),o.set(i,b-1,M[0]),o.set(i,b,M[1])):(c=o.get(i,i+1),m=o.get(i+1,i),p=(r[i]-R)*(r[i]-R)+e[i]*e[i]-A*A,d=(r[i]-R)*2*A,0===p&&0===d&&(p=E*v*(Math.abs(f)+Math.abs(A)+Math.abs(c)+Math.abs(m)+Math.abs(T))),M=q(c*C-T*g+A*w,c*k-T*w-A*g,p,d),o.set(i,b-1,M[0]),o.set(i,b,M[1]),Math.abs(c)>Math.abs(T)+Math.abs(A)?(o.set(i+1,b-1,(-g-f*o.get(i,b-1)+A*o.get(i,b))/c),o.set(i+1,b,(-w-f*o.get(i,b)-A*o.get(i,b-1))/c)):(M=q(-C-m*o.get(i,b-1),-k-m*o.get(i,b),T,A),o.set(i+1,b-1,M[0]),o.set(i+1,b,M[1]))),E*(u=Math.max(Math.abs(o.get(i,b-1)),Math.abs(o.get(i,b))))*u>1)for(n=i;n<=b;n++)o.set(n,b-1,o.get(n,b-1)/u),o.set(n,b,o.get(n,b)/u)}for(i=0;i<t;i++)if(i<0||i>x)for(n=i;n<t;n++)s.set(i,n,o.get(i,n));for(n=t-1;n>=0;n--)for(i=0;i<=x;i++){for(l=0,T=0;l<=Math.min(n,x);l++)T+=s.get(i,l)*o.get(l,n);s.set(i,n,T)}}}(i,h,l,n,t)}this.n=i,this.e=h,this.d=l,this.V=n}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let t,e,r=this.n,s=this.e,o=this.d,i=new x(r,r);for(t=0;t<r;t++){for(e=0;e<r;e++)i.set(t,e,0);i.set(t,t,o[t]),s[t]>0?i.set(t,t+1,s[t]):s[t]<0&&i.set(t,t-1,s[t])}return i}}function q(t,e,r,s){let o,i;return Math.abs(r)>Math.abs(s)?(o=s/r,i=r+o*s,[(t+o*e)/i,(e-o*t)/i]):(o=r/s,i=s+o*r,[(o*t+e)/i,(o*e-t)/i])}class z{constructor(t){let e,r,s;if(!(t=C.checkMatrix(t)).isSymmetric())throw Error("Matrix is not symmetric");let o=t,i=o.rows,n=new x(i,i),l=!0;for(r=0;r<i;r++){let t=0;for(s=0;s<r;s++){let i=0;for(e=0;e<s;e++)i+=n.get(s,e)*n.get(r,e);i=(o.get(r,s)-i)/n.get(s,s),n.set(r,s,i),t+=i*i}for(t=o.get(r,r)-t,l&&=t>0,n.set(r,r,Math.sqrt(Math.max(t,0))),s=r+1;s<i;s++)n.set(r,s,0)}this.L=n,this.positiveDefinite=l}isPositiveDefinite(){return this.positiveDefinite}solve(t){let e,r,s;t=C.checkMatrix(t);let o=this.L,i=o.rows;if(t.rows!==i)throw Error("Matrix dimensions do not match");if(!1===this.isPositiveDefinite())throw Error("Matrix is not positive definite");let n=t.columns,l=t.clone();for(s=0;s<i;s++)for(r=0;r<n;r++){for(e=0;e<s;e++)l.set(s,r,l.get(s,r)-l.get(e,r)*o.get(s,e));l.set(s,r,l.get(s,r)/o.get(s,s))}for(s=i-1;s>=0;s--)for(r=0;r<n;r++){for(e=s+1;e<i;e++)l.set(s,r,l.get(s,r)-l.get(e,r)*o.get(e,s));l.set(s,r,l.get(s,r)/o.get(s,s))}return l}get lowerTriangularMatrix(){return this.L}}class F{constructor(t,e={}){let r,o,i,n,l;t=C.checkMatrix(t);let{Y:h}=e;const{scaleScores:a=!1,maxIterations:u=1e3,terminationCriteria:f=1e-10}=e;if(h){if((h=s.isAnyArray(h)&&"number"==typeof h[0]?x.columnVector(h):C.checkMatrix(h)).rows!==t.rows)throw Error("Y should have the same number of rows as X");r=h.getColumnVector(0)}else r=t.getColumnVector(0);let c=1;for(let e=0;e<u&&c>f;e++)n=(n=t.transpose().mmul(r).div(r.transpose().mmul(r).get(0,0))).div(n.norm()),o=t.mmul(n).div(n.transpose().mmul(n).get(0,0)),e>0&&(c=o.clone().sub(l).pow(2).sum()),l=o.clone(),h?(i=(i=h.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0))).div(i.norm()),r=h.mmul(i).div(i.transpose().mmul(i).get(0,0))):r=o;if(h){let e=t.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0));e=e.div(e.norm());let s=t.clone().sub(o.clone().mmul(e.transpose())),l=r.transpose().mmul(o).div(o.transpose().mmul(o).get(0,0)),a=h.clone().sub(o.clone().mulS(l.get(0,0)).mmul(i.transpose()));this.t=o,this.p=e.transpose(),this.w=n.transpose(),this.q=i,this.u=r,this.s=o.transpose().mmul(o),this.xResidual=s,this.yResidual=a,this.betas=l}else this.w=n.transpose(),this.s=o.transpose().mmul(o).sqrt(),a?this.t=o.clone().div(this.s.get(0,0)):this.t=o,this.xResidual=t.sub(o.mmul(n.transpose()))}}r.AbstractMatrix=M,r.CHO=z,r.CholeskyDecomposition=z,r.DistanceMatrix=S,r.EVD=N,r.EigenvalueDecomposition=N,r.LU=k,r.LuDecomposition=k,r.Matrix=x,r.MatrixColumnSelectionView=class extends v{constructor(t,e){g(t,e),super(t,t.rows,e.length),this.columnIndices=e}set(t,e,r){return this.matrix.set(t,this.columnIndices[e],r),this}get(t,e){return this.matrix.get(t,this.columnIndices[e])}},r.MatrixColumnView=class extends v{constructor(t,e){u(t,e),super(t,t.rows,1),this.column=e}set(t,e,r){return this.matrix.set(t,this.column,r),this}get(t){return this.matrix.get(t,this.column)}},r.MatrixFlipColumnView=class extends v{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(t,this.columns-e-1,r),this}get(t,e){return this.matrix.get(t,this.columns-e-1)}},r.MatrixFlipRowView=class extends v{constructor(t){super(t,t.rows,t.columns)}set(t,e,r){return this.matrix.set(this.rows-t-1,e,r),this}get(t,e){return this.matrix.get(this.rows-t-1,e)}},r.MatrixRowSelectionView=class extends v{constructor(t,e){m(t,e),super(t,e.length,t.columns),this.rowIndices=e}set(t,e,r){return this.matrix.set(this.rowIndices[t],e,r),this}get(t,e){return this.matrix.get(this.rowIndices[t],e)}},r.MatrixRowView=class extends v{constructor(t,e){a(t,e),super(t,1,t.columns),this.row=e}set(t,e,r){return this.matrix.set(this.row,e,r),this}get(t,e){return this.matrix.get(this.row,e)}},r.MatrixSelectionView=R,r.MatrixSubView=class extends v{constructor(t,e,r,s,o){w(t,e,r,s,o),super(t,r-e+1,o-s+1),this.startRow=e,this.startColumn=s}set(t,e,r){return this.matrix.set(this.startRow+t,this.startColumn+e,r),this}get(t,e){return this.matrix.get(this.startRow+t,this.startColumn+e)}},r.MatrixTransposeView=class extends v{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}},r.NIPALS=F,r.Nipals=F,r.QR=V,r.QrDecomposition=V,r.SVD=I,r.SingularValueDecomposition=I,r.SymmetricMatrix=E,r.WrapperMatrix1D=A,r.WrapperMatrix2D=C,r.correlation=function(t,e=t,r={}){t=new x(t);let o=!1;if("object"!=typeof e||x.isMatrix(e)||s.isAnyArray(e)?e=new x(e):(r=e,e=t,o=!0),t.rows!==e.rows)throw TypeError("Both matrices must have the same number of rows");let{center:i=!0,scale:n=!0}=r;i&&(t.center("column"),o||e.center("column")),n&&(t.scale("column"),o||e.scale("column"));let l=t.standardDeviation("column",{unbiased:!0}),h=o?l:e.standardDeviation("column",{unbiased:!0}),a=t.transpose().mmul(e);for(let e=0;e<a.rows;e++)for(let r=0;r<a.columns;r++)a.set(e,r,a.get(e,r)*(1/(l[e]*h[r]))*(1/(t.rows-1)));return a},r.covariance=function(t,e=t,r={}){t=new x(t);let o=!1;if("object"!=typeof e||x.isMatrix(e)||s.isAnyArray(e)?e=new x(e):(r=e,e=t,o=!0),t.rows!==e.rows)throw TypeError("Both matrices must have the same number of rows");let{center:i=!0}=r;i&&(t=t.center("column"),o||(e=e.center("column")));let n=t.transpose().mmul(e);for(let e=0;e<n.rows;e++)for(let r=0;r<n.columns;r++)n.set(e,r,n.get(e,r)*(1/(t.rows-1)));return n},r.default=x,r.determinant=function t(e){if((e=x.checkMatrix(e)).isSquare()){let r,s,o;if(0===e.columns)return 1;if(2===e.columns)return r=e.get(0,0),s=e.get(0,1),o=e.get(1,0),r*e.get(1,1)-s*o;if(3!==e.columns)return new k(e).determinant;{let i,n,l;return i=new R(e,[1,2],[1,2]),n=new R(e,[1,2],[0,2]),l=new R(e,[1,2],[0,1]),r=e.get(0,0),s=e.get(0,1),o=e.get(0,2),r*t(i)-s*t(n)+o*t(l)}}throw Error("determinant can only be calculated for a square matrix")},r.inverse=function(t,e=!1){return(t=C.checkMatrix(t),e)?new I(t).inverse():D(t,x.eye(t.rows))},r.linearDependencies=function(t,e={}){let{thresholdValue:r=1e-9,thresholdError:s=1e-9}=e,o=(t=x.checkMatrix(t)).rows,i=new x(o,o);for(let e=0;e<o;e++){let n=x.columnVector(t.getRow(e)),l=t.subMatrixRow(function(t,e){let r=[];for(let s=0;s<t;s++)s!==e&&r.push(s);return r}(o,e)).transpose(),h=new I(l).solve(n),a=x.sub(n,l.mmul(h)).abs().max();i.setRow(e,function(t,e,r,s=1e-9,o=1e-9){if(t>o)return Array(e.rows+1).fill(0);{let t=e.addRow(r,[0]);for(let e=0;e<t.rows;e++)Math.abs(t.get(e,0))<s&&t.set(e,0,0);return t.to1DArray()}}(a,h,e,r,s))}return i},r.pseudoInverse=function(t,e=Number.EPSILON){if((t=x.checkMatrix(t)).isEmpty())return t.transpose();let r=new I(t,{autoTranspose:!0}),s=r.leftSingularVectors,o=r.rightSingularVectors,i=r.diagonal;for(let t=0;t<i.length;t++)Math.abs(i[t])>e?i[t]=1/i[t]:i[t]=0;return o.mmul(x.diag(i).mmul(s.transpose()))},r.solve=D,r.wrap=function(t,e){if(s.isAnyArray(t))if(t[0]&&s.isAnyArray(t[0]))return new C(t);else return new A(t,e);throw Error("the argument is not an array")}},30815,t=>{"use strict";var e=t.i(71018);e.AbstractMatrix,e.CHO,e.CholeskyDecomposition,e.DistanceMatrix,e.EVD,e.EigenvalueDecomposition,e.LU,e.LuDecomposition;let r=e.Matrix;e.MatrixColumnSelectionView,e.MatrixColumnView,e.MatrixFlipColumnView,e.MatrixFlipRowView,e.MatrixRowSelectionView,e.MatrixRowView,e.MatrixSelectionView,e.MatrixSubView,e.MatrixTransposeView,e.NIPALS,e.Nipals,e.QR,e.QrDecomposition,e.SVD;let s=e.SingularValueDecomposition;e.SymmetricMatrix,e.WrapperMatrix1D,e.WrapperMatrix2D,e.correlation,e.covariance,e.default.Matrix?e.default.Matrix:e.Matrix,e.determinant;let o=e.inverse;e.linearDependencies,e.pseudoInverse,e.solve,e.wrap;var i=t.i(91709);function n(t,e,r,s){let o=0,i=r(e);for(let e=0;e<t.x.length;e++)o+=Math.pow(t.y[e]-i(t.x[e]),2)/s[e];return o}function l(t){let e=0,s=0;t.forEach(t=>{e+=t.x,s+=t.y}),e/=t.length,s/=t.length;let o=0;t.forEach(t=>{o+=Math.sqrt((t.x-e)**2+(t.y-s)**2)});let i=Math.sqrt(2)/(o/=t.length),n=new r([[i,0,-i*e],[0,i,-i*s],[0,0,1]]);return{points:t.map(t=>{let e=new r([[t.x],[t.y],[1]]),s=n.mmul(e);return{x:s.get(0,0),y:s.get(1,0)}}),T:n}}function h(t){let e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);if(e<1e-8)return r.eye(3);let s=new r([[t[0]/e],[t[1]/e],[t[2]/e]]),o=new r([[0,-s.get(2,0),s.get(1,0)],[s.get(2,0),0,-s.get(0,0)],[-s.get(1,0),s.get(0,0),0]]),i=r.eye(3),n=o.mmul(o),l=o.mul(Math.sin(e)),h=n.mul(1-Math.cos(e));return i.add(l).add(h)}let a=null,u=null,f=null,c=null,m=null,g=null,w=!1;async function p(){if(!w)return new Promise((t,e)=>{let r={onRuntimeInitialized:()=>{console.log("[Worker] OpenCV Runtime Initialized via Module callback"),g=self.cv&&self.cv.Mat?self.cv:r,w=!0,t()},onError:t=>{console.error("[Worker] OpenCV Module Error:",t)},print:t=>console.log("[OpenCV]",t),printErr:t=>console.warn("[OpenCV]",t)};self.Module=r,self.module=void 0,self.exports=void 0,self.define=void 0,self.window||(self.window=self);let s=0,o=setInterval(()=>{s++;let e=self.cv;e&&e.Mat&&e.findChessboardCorners?(clearInterval(o),w||(console.log("[Worker] OpenCV (fully loaded) found via Polling"),g=e,w=!0,t())):e&&e.Mat&&!e.findChessboardCorners?s%10==0&&console.log("[Worker] OpenCV found but findChessboardCorners missing. Waiting..."):"function"==typeof e&&!w&&s<5&&(console.log("[Worker] cv is function, attempting call..."),Promise.resolve(e(r)).then(e=>{g=e,w=!0,t()}).catch(()=>{})),s>200&&s%50==0&&console.warn("[Worker] Still waiting for OpenCV...")},100);console.log("[Worker] Loading OpenCV script...");try{let t=self.location.origin;importScripts(`${t}/opencv.js`),console.log("[Worker] importScripts executed")}catch(t){console.warn("[Worker] Local load failed, trying CDN",t);try{importScripts("https://docs.opencv.org/4.5.0/opencv.js")}catch(t){e(Error(`Failed to load OpenCV: ${t}`))}}})}async function d(t,e){let{boardType:r}=e;if("aprilgrid"===r){if(!a)throw Error("AprilTag not initialized");return function({imageData:t}){let{width:e,height:r,data:s}=t,o=new Uint8Array(e*r);for(let t=0;t<e*r;t++){let e=s[4*t],r=s[4*t+1],i=s[4*t+2];o[t]=.299*e+.587*r+.114*i}let i=c(e,r,e);if(0===i)throw Error("Failed to allocate memory for image in WASM");a.HEAPU8.set(o,i);let n=u();if(0===n)return{found:!1,detections:[],error:"WASM Internal Error: Returned NULL pointer"};let l=a.getValue(n,"i32"),h=a.getValue(n+4,"i32");if(h>0&&0!==l)try{let t=a.HEAPU8.subarray(l,l+h),e=new TextDecoder("utf8").decode(t);if(!(e=e.replace(/\u0000/g,"")).trim().startsWith("["))return{found:!1,detections:[],error:`WASM Output Error: ${e}`};let r=JSON.parse(e);return{found:r.length>0,detections:r}}catch(t){return{found:!1,detections:[],error:`JSON Parse Error: ${t.message}`}}return{found:!1,detections:[],error:"No detection result returned from WASM"}}({imageData:t})}if("checkerboard"===r||"chessboard"===r){if(await p(),!g||!g.findChessboardCorners)throw Error("OpenCV loaded but calibration functions are missing. Please replace public/opencv.js with a full build (including calib3d).");return function(t,e){try{let{rows:r,cols:s}=e;if(console.log(`[Worker] Detecting Chessboard: ${s}x${r} (inner corners)`),!g)return console.error("[Worker] OpenCV not loaded"),{found:!1,corners:[],error:"OpenCV not loaded"};let o=g.matFromImageData(t),i=new g.Mat;g.cvtColor(o,i,g.COLOR_RGBA2GRAY);let n=new g.Mat,l=new g.Size(s,r);console.log(`[Worker] Attempt 1: ${s}x${r}`);let h=g.findChessboardCorners(i,l,n,3);if(h||(console.log("[Worker] Attempt 1 failed. Trying (cols-1)x(rows-1)..."),l=new g.Size(s-1,r-1),h=g.findChessboardCorners(i,l,n,3)),h||(console.log("[Worker] Attempt 2 failed. Trying swapped cols/rows..."),l=new g.Size(r,s),h=g.findChessboardCorners(i,l,n,3)),h){console.log(`[Worker] Checkerboard found! Size: ${l.width}x${l.height}`);let t=new g.Size(5,5),e=new g.Size(-1,-1),r=new g.TermCriteria(g.TERM_CRITERIA_EPS+g.TERM_CRITERIA_COUNT,30,.001);g.cornerSubPix(i,n,t,e,r);let s=[];for(let t=0;t<n.rows;++t)s.push({x:n.data32F[2*t],y:n.data32F[2*t+1]});return o.delete(),i.delete(),n.delete(),{found:!0,corners:s}}return console.log("[Worker] Checkerboard NOT found."),o.delete(),i.delete(),n.delete(),{found:!1,corners:[],error:"Checkerboard pattern not found. Tried normal, inner-corners, and swapped dimensions."}}catch(t){return console.error("OpenCV Checkerboard Error:",t),{found:!1,corners:[],error:`OpenCV Error: ${t.message||t}`}}}(t,e)}if("charuco"===r)throw Error("ChArUco detection not yet implemented in worker.");throw Error(`Unknown board type: ${r}`)}async function y(t){if(!a)return new Promise((e,r)=>{let s=new URL(t,self.location.origin).toString();self.Module={locateFile:t=>t.endsWith(".wasm")?new URL("/apriltag.wasm",self.location.origin).toString():t,onRuntimeInitialized:()=>{console.log("AprilTag WASM Initialized")}},importScripts(s);let o=async()=>{self.AprilTagWasm?(f=(a=await self.AprilTagWasm(self.Module)).cwrap("atagjs_init","number",[]),a.cwrap("atagjs_destroy","number",[]),m=a.cwrap("atagjs_set_detector_options","number",["number","number","number","number","number","number","number"]),c=a.cwrap("atagjs_set_img_buffer","number",["number","number","number"]),u=a.cwrap("atagjs_detect","number",[]),console.log("atag_init returned:",f()),m(2,0,1,1,10,0,0),console.log("AprilTag WASM Initialized (Safe Options Set)"),e()):setTimeout(o,100)};o()})}self.onmessage=async t=>{let{type:e,payload:a,id:u}=t.data;try{switch(e){case"INIT":await y(a.url),self.postMessage({type:"INIT_SUCCESS",id:u});break;case"DETECT":let t=await d(a.imageData,a.settings);self.postMessage({type:"DETECT_SUCCESS",id:u,payload:t});break;case"CALIBRATE":let f=function(t,e,a){let u,f,c,m,g,w,p,d,y,M,b,x,E,S,v=[],{points:R,T:A}=l(e);for(let e of t){let{points:t,T:i}=l(e),n=function(t,e){let o=t.length,i=[];for(let r=0;r<o;r++){let s=t[r].x,o=t[r].y,n=e[r].x,l=e[r].y;i.push([-s,-o,-1,0,0,0,n*s,n*o,n]),i.push([0,0,0,-s,-o,-1,l*s,l*o,l])}let n=new s(new r(i)).rightSingularVectors.getColumn(8),l=new r(3,3);return l.set(0,0,n[0]),l.set(0,1,n[1]),l.set(0,2,n[2]),l.set(1,0,n[3]),l.set(1,1,n[4]),l.set(1,2,n[5]),l.set(2,0,n[6]),l.set(2,1,n[7]),l.set(2,2,n[8]),l}(R,t),h=o(i).mmul(n).mmul(A);h.div(h.get(2,2)),v.push(h)}let C=(u=new r(2*v.length,6),f=(t,e,r)=>{let s=t.getColumn(e),o=t.getColumn(r);return[s[0]*o[0],s[0]*o[1]+s[1]*o[0],s[1]*o[1],s[2]*o[0]+s[0]*o[2],s[2]*o[1]+s[1]*o[2],s[2]*o[2]]},v.forEach((t,e)=>{let r=f(t,0,1),s=f(t,0,0),o=f(t,1,1),i=s.map((t,e)=>t-o[e]);for(let t=0;t<6;t++)u.set(2*e,t,r[t]),u.set(2*e+1,t,i[t])}),m=(c=new s(u).rightSingularVectors.getColumn(5))[0],g=c[1],w=c[2],p=c[3],d=c[4],y=c[5],M=(g*p-m*d)/(m*w-g*g),b=y-(p*p+M*(g*p-m*d))/m,x=Math.sqrt(Math.abs(b/m)),E=Math.sqrt(Math.abs(b*m/(m*w-g*g))),S=-g*x*x*E/b,{fx:x,fy:E,cx:S*M/E-p*x*x/b,cy:M,skew:S}),k=new r([[C.fx,C.skew,C.cx],[0,C.fy,C.cy],[0,0,1]]),T=v.map(t=>(function(t,e){let i=o(e),n=t.getColumn(0),l=t.getColumn(1),h=t.getColumn(2),a=new r(3,1);for(let t=0;t<3;t++)a.set(t,0,n[t]);a.norm();let u=new r(3,1);for(let t=0;t<3;t++)u.set(t,0,n[t]);let f=new r(3,1);for(let t=0;t<3;t++)f.set(t,0,l[t]);let c=new r(3,1);for(let t=0;t<3;t++)c.set(t,0,h[t]);let m=i.mmul(u),g=i.mmul(f),w=i.mmul(c),p=1/m.norm(),d=m.mul(p),y=g.mul(p),M=new r([[d.get(1,0)*y.get(2,0)-d.get(2,0)*y.get(1,0)],[d.get(2,0)*y.get(0,0)-d.get(0,0)*y.get(2,0)],[d.get(0,0)*y.get(1,0)-d.get(1,0)*y.get(0,0)]]),b=w.mul(p),x=new r(3,3);x.setColumn(0,d.to1DArray()),x.setColumn(1,y.to1DArray()),x.setColumn(2,M.to1DArray());let E=new s(x),S=E.leftSingularVectors.mmul(E.rightSingularVectors.transpose());if(0>b.get(2,0)){b.mul(-1),d.mul(-1),y.mul(-1),x.setColumn(0,d.to1DArray()),x.setColumn(1,y.to1DArray()),x.setColumn(2,M.to1DArray());let t=new s(x);return{R:t.leftSingularVectors.mmul(t.rightSingularVectors.transpose()),t:b}}return{R:S,t:b}})(t,k)),V=[C.fx,C.fy,C.cx,C.cy,0,0];T.forEach(t=>{let e=function(t){let e=(t.trace()-1)/2;e>1&&(e=1),e<-1&&(e=-1);let r=Math.acos(e);if(1e-8>Math.abs(r))return[0,0,0];let s=r/(2*Math.sin(r)),o=(t.get(2,1)-t.get(1,2))*s,i=(t.get(0,2)-t.get(2,0))*s;return[o,i,(t.get(1,0)-t.get(0,1))*s]}(t.R);V.push(e[0],e[1],e[2]),V.push(t.t.get(0,0),t.t.get(1,0),t.t.get(2,0))});let I=[],D=[];t.forEach((t,e)=>{t.forEach((t,r)=>{I.push([e,r,0]),D.push(t.x),I.push([e,r,1]),D.push(t.y)})});try{let s=function(t,e,s){let{checkTimeout:l,minValues:h,maxValues:a,parameters:u,weightSquare:f,damping:c,dampingStepUp:m,dampingStepDown:g,maxIterations:w,errorTolerance:p,centralDifference:d,gradientDifference:y,improvementThreshold:M}=function(t,e,r){let s,o,{timeout:n,minValues:l,maxValues:h,initialValues:a,weights:u=1,damping:f=.01,dampingStepUp:c=11,dampingStepDown:m=9,maxIterations:g=100,errorTolerance:w=1e-7,centralDifference:p=!1,gradientDifference:d=.1,improvementThreshold:y=.001}=r;if(f<=0)throw Error("The damping option must be a positive number");if(t.x&&t.y){if(!(0,i.isAnyArray)(t.x)||t.x.length<2||!(0,i.isAnyArray)(t.y)||t.y.length<2)throw Error("The data parameter elements must be an array with more than 2 points");else if(t.x.length!==t.y.length)throw Error("The data parameter elements must have the same size")}else throw Error("The data parameter must have x and y elements");if(!(a&&a.length>0))throw Error("The initialValues option is mandatory and must be an array");let M=t.y.length,b=a.length;if(h=h||Array(b).fill(Number.MAX_SAFE_INTEGER),l=l||Array(b).fill(Number.MIN_SAFE_INTEGER),h.length!==l.length)throw Error("minValues and maxValues must be the same size");if("number"==typeof d)d=Array(a.length).fill(d);else if((0,i.isAnyArray)(d))d.length!==b&&(d=Array(b).fill(d[0]));else throw Error("gradientDifference should be a number or array with length equal to the number of parameters");if("number"==typeof u){let t=1/u**2;s=()=>t}else if((0,i.isAnyArray)(u))if(u.length<t.x.length){let t=1/u[0]**2;s=()=>t}else s=t=>1/u[t]**2;else throw Error("weights should be a number or array with length equal to the number of data points");if(void 0!==n){if("number"!=typeof n)throw Error("timeout should be a number");let t=Date.now()+1e3*n;o=()=>Date.now()>t}else o=()=>!1;let x=Array(t.x.length);for(let t=0;t<M;t++)x[t]=s(t);return{checkTimeout:o,minValues:l,maxValues:h,parameters:a,weightSquare:x,damping:f,dampingStepUp:c,dampingStepDown:m,maxIterations:g,errorTolerance:w,centralDifference:p,gradientDifference:d,improvementThreshold:y}}(t,0,s),b=n(t,u,e,f),x=b,E=u.slice(),S=b<=p,v=0;for(;v<w&&!S;v++){let i=b,{perturbations:w,jacobianWeightResidualError:v}=function(t,e,s,i,n,l,h){let a=r.eye(e.length,e.length,s),u=n(e),f=new Float64Array(t.x.length);for(let e=0;e<t.x.length;e++)f[e]=u(t.x[e]);let c=function(t,e,s,o,i,n){let l=s.length,h=t.x.length,a=r.zeros(l,h),u=0;for(let r=0;r<l;r++){if(0===o[r])continue;let l=o[r],f=s.slice();f[r]+=l;let c=i(f);if(n){f=s.slice(),f[r]-=l,l*=2;let e=i(f);for(let r=0;r<h;r++)a.set(u,r,(e(t.x[r])-c(t.x[r]))/l)}else for(let r=0;r<h;r++)a.set(u,r,(e[r]-c(t.x[r]))/l);u++}return a}(t,f,e,i,n,l),m=function(t,e){let s=t.x.length,o=new r(s,1);for(let r=0;r<s;r++)o.set(r,0,t.y[r]-e[r]);return o}(t,f),g=o(a.add(c.mmul(c.transpose().scale("row",{scale:h})))),w=c.mmul(m.scale("row",{scale:h}));return{perturbations:g.mmul(w),jacobianWeightResidualError:w}}(t,u,c,y,e,d,f);for(let t=0;t<u.length;t++)u[t]=Math.min(Math.max(h[t],u[t]-w.get(t,0)),a[t]);if(isNaN(b=n(t,u,e,f)))break;if(b<x-p&&(x=b,E=u.slice()),c=(i-b)/w.transpose().mmul(w.mul(c).add(v)).get(0,0)>M?Math.max(c/g,1e-7):Math.min(c*m,1e7),l())throw Error(`The execution time is over to ${s.timeout} seconds`);S=b<=p}return{parameterValues:E,parameterError:x,iterations:v}}({x:I,y:D},t=>{let[s,o,i,n,l,a]=t,u=[];for(let e=0;e<T.length;e++){let s=6+6*e,o=[t[s],t[s+1],t[s+2]],i=[t[s+3],t[s+4],t[s+5]];u.push({R:h(o),t:new r([[i[0]],[i[1]],[i[2]]])})}return t=>{let h=t[0],f=t[1],c=1===t[2],{R:m,t:g}=u[h],w=e[f],p=new r([[w.x],[w.y],[0]]),d=m.mmul(p).add(g),y=d.get(2,0);if(1e-6>Math.abs(y))return 0;let M=d.get(0,0)/y,b=d.get(1,0)/y,x=M*M+b*b,E=x*x;return c?b*(1+l*x+a*E)*o+n:M*(1+l*x+a*E)*s+i}},{damping:1.5,initialValues:V,gradientDifference:.1,maxIterations:50,errorTolerance:.01}),l=s.parameterValues||s,[a,u,f,c,m,g]=l,w=Math.sqrt((s.parameterError||0)/D.length),p=[],d=new r([[a,0,f],[0,u,c],[0,0,1]]),y=[m,g,0,0,0];return t.forEach((t,s)=>{let o=6+6*s,i=[l[o],l[o+1],l[o+2]],n=[l[o+3],l[o+4],l[o+5]],a=h(i),u=new r([[n[0]],[n[1]],[n[2]]]),f=0;t.forEach((t,s)=>{var o,i;let n,l,h,c,m,g,w,p,M,b,x,E,S=e[s],v=(o=S.x,i=S.y,n=new r([[o],[i],[0]]),h=(l=a.mmul(n).add(u)).get(0,0)/l.get(2,0),c=l.get(1,0)/l.get(2,0),g=(m=h*h+c*c)*m,w=y[0]||0,p=y[1]||0,M=d.get(0,0),b=d.get(1,1),x=d.get(0,2),E=d.get(1,2),{u:h*(1+w*m+p*g)*M+x,v:c*(1+w*m+p*g)*b+E}),R=(v.u-t.x)**2+(v.v-t.y)**2;f+=R});let c=f/t.length;p.push(Math.sqrt(c))}),{cameraMatrix:[a,0,f,0,u,c,0,0,1],distCoeffs:[m,g,0,0,0],rms:w,perViewErrors:p,rvecs:T.map((t,e)=>{let r=6+6*e;return[l[r],l[r+1],l[r+2]]}),tvecs:T.map((t,e)=>{let r=6+6*e;return[l[r+3],l[r+4],l[r+5]]})}}catch(t){return console.error("Calibration optimization failed:",t),{cameraMatrix:[C.fx,0,C.cx,0,C.fy,C.cy,0,0,1],distCoeffs:[0,0,0,0,0],rms:-1,perViewErrors:[],rvecs:T.map(t=>[0,0,0]),tvecs:T.map(t=>[t.t.get(0,0),t.t.get(1,0),t.t.get(2,0)])}}}(a.allImagePoints,a.objPoints,a.imageSize);self.postMessage({type:"CALIBRATE_SUCCESS",id:u,payload:f});break;default:throw Error(`Unknown message type: ${e}`)}}catch(t){self.postMessage({type:"ERROR",id:u,error:t.message})}},t.s([],30815)}]);